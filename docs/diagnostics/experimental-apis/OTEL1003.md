# OpenTelemetry .NET Diagnostic: OTEL1003

## Overview

This is an Experimental API diagnostic covering the following API:

* `MeterProviderBuilderExtensions.SetCardinalityLimit`
* `MetricReaderOptions.CardinalityLimit.get`
* `MetricReaderOptions.CardinalityLimit.set`
* `MetricStreamConfiguration.CardinalityLimit.get`
* `MetricStreamConfiguration.CardinalityLimit.set`

Experimental APIs may be changed or removed in the future.

## Details

From the specification:

> The cardinality limit for an aggregation is defined in one of three ways: A
> view with criteria matching the instrument an aggregation is created for has
> an aggregation_cardinality_limit value defined for the stream, that value
> SHOULD be used. If there is no matching view, but the MetricReader defines a
> default cardinality limit value based on the instrument an aggregation is
> created for, that value SHOULD be used. If none of the previous values are
> defined, the default value of 2000 SHOULD be used.

We are exposing these APIs experimentally until the specification declares them
stable.

### Setting the default cardinality limit for the MeterProvider:

There is nothing in the OpenTelemetry Specification currently for defining the
default cardinality limit for a MeterProvider.

```csharp
using var meterProvider = Sdk.CreateMeterProviderBuilder()
    .SetCardinalityLimit(5000)
    .Build();
```

### Setting the default cardinality limit for a MetricReader:

The OpenTelemetry Specification defines the [cardinality
limit](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/metrics/sdk.md#metricreader)
of a MetricReader can be set during construction.

```csharp
var metricReader = new PeriodicExportingMetricReader(
    metricExporter,
    new MetricReaderOptions()
    {
        CardinalityLimit = 5000,
    });
```

### Setting cardinality limit for a specific Metric via the View API:

The OpenTelemetry Specification defines the [cardinality
limit](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/metrics/sdk.md#cardinality-limits)
of a metric can be set by the matching view.

```csharp
using var meterProvider = Sdk.CreateMeterProviderBuilder()
    .AddView(i =>
    {
        if (i.Name == "MyInstrumentName")
        {
            return new MetricStreamConfiguration
            {
                CardinalityLimit = 5000,
            };
        }

        return null;
    })
    .Build();
```
